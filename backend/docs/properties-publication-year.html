<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOCiD Metadata Schema - Property 5: Publication Year</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="doc-wrapper">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>DOCiD Schema</h2>
                <div class="version-info">Version 1.0</div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Documentation</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">Introduction</a>
                        </li>
                        <li class="nav-item">
                            <a href="architecture.html" class="nav-link">System Architecture</a>
                        </li>
                        <li class="nav-item">
                            <a href="metadata-schema.html" class="nav-link">Metadata Properties</a>
                            <ul class="nav-sublist">
                                <li class="nav-item">
                                    <a href="metadata-schema.html#core-properties" class="nav-link">Core Properties (1-20)</a>
                                </li>
                                <li class="nav-item">
                                    <a href="metadata-schema.html#publication-model" class="nav-link">Publication Model</a>
                                </li>
                                <li class="nav-item">
                                    <a href="metadata-schema.html#creator-model" class="nav-link">Creator Management</a>
                                </li>
                                <li class="nav-item">
                                    <a href="metadata-schema.html#controlled-vocabularies" class="nav-link">Controlled Vocabularies</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="api-reference.html" class="nav-link">API Reference</a>
                            <ul class="nav-sublist">
                                <li class="nav-item">
                                    <a href="api-reference.html#authentication-endpoints" class="nav-link">Authentication</a>
                                </li>
                                <li class="nav-item">
                                    <a href="api-reference.html#publication-endpoints" class="nav-link">Publications</a>
                                </li>
                                <li class="nav-item">
                                    <a href="api-reference.html#comments-endpoints" class="nav-link">Comments System</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="external-services.html" class="nav-link">External Services</a>
                            <ul class="nav-sublist">
                                <li class="nav-item">
                                    <a href="external-services.html#cordra-integration" class="nav-link">CORDRA</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#crossref-integration" class="nav-link">Crossref</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#cstr-integration" class="nav-link">CSTR</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#ror-integration" class="nav-link">ROR</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#orcid-integration" class="nav-link">ORCID</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Properties</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="properties-identifier.html" class="nav-link">1. Identifier</a>
                        </li>
                        <li class="nav-item">
                            <a href="properties-creator.html" class="nav-link">2. Creator</a>
                        </li>
                        <li class="nav-item">
                            <a href="properties-title.html" class="nav-link">3. Title</a>
                        </li>
                        <li class="nav-item">
                            <a href="properties-publisher.html" class="nav-link">4. Publisher</a>
                        </li>
                        <li class="nav-item">
                            <a href="properties-publication-year.html" class="nav-link active">5. Publication Year</a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Appendices</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#controlled-vocabularies" class="nav-link">Controlled Vocabularies</a>
                        </li>
                        <li class="nav-item">
                            <a href="#cultural-protocols" class="nav-link">Cultural Protocols</a>
                        </li>
                        <li class="nav-item">
                            <a href="#validation-rules" class="nav-link">Validation Rules</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" onclick="toggleSidebar()">â˜°</button>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-wrapper">
                <header class="doc-header">
                    <h1>Property 5: Publication Year</h1>
                    <div class="subtitle">The year when the data was or will be made publicly available</div>
                </header>

                <!-- Property Overview -->
                <section id="property-overview">
                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">5. Publication Year</div>
                            <div class="property-meta">
                                <span class="property-badge">Required</span>
                                <span>Occurrences: 1</span>
                            </div>
                        </div>
                        <div class="property-content">
                            <p><strong>Definition:</strong> The year when the data was or will be made publicly available. In the case of resources that span multiple years, the year refers to when the resource was made available, not the timespan that the resource covers.</p>
                            
                            <h4>Allowed values, examples, other constraints:</h4>
                            <p>YYYY format. Must be a valid four-digit year. Future years are allowed for embargoed resources.</p>
                            
                            <h4>Examples:</h4>
                            <ul>
                                <li><strong>2024:</strong> Resource published in 2024</li>
                                <li><strong>2025:</strong> Resource scheduled for publication in 2025 (embargoed)</li>
                                <li><strong>2023:</strong> Historical publication from 2023</li>
                            </ul>
                            
                            <h4>DOCiD Implementation:</h4>
                            <p>Publication year is managed through multiple date fields in the Publications model for comprehensive temporal tracking:</p>
                            
                            <div class="code-example">
                                <div class="code-header">Publications Model - Date Fields</div>
                                <div class="code-content">
                                    <pre><code>class Publications(db.Model):
    __tablename__ = 'publications'
    
    # Creation and modification timestamps
    timestamp = Column(Integer, default=lambda: int(datetime.utcnow().timestamp()))
    
    # Publication date (Property 5: Publication Year)
    published = Column(DateTime, default=datetime.utcnow)
    
    # Additional date tracking
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)
    updated_at = Column(DateTime, onupdate=datetime.utcnow)</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Date Management -->
                <section id="date-management">
                    <h2>Date Management in DOCiD</h2>
                    
                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">Multiple Date Fields</div>
                            <div class="property-meta">
                                <span class="property-badge">Implementation</span>
                                <span>Publications Model</span>
                            </div>
                        </div>
                        <div class="property-content">
                            <p>DOCiD tracks multiple dates to provide comprehensive temporal information:</p>
                            
                            <h4>Date Field Definitions:</h4>
                            <ul>
                                <li><strong>created_at:</strong> When the record was first created in the system</li>
                                <li><strong>updated_at:</strong> When the record was last modified</li>
                                <li><strong>published:</strong> When the resource was/will be made publicly available (Publication Year)</li>
                                <li><strong>timestamp:</strong> UNIX timestamp for efficient sorting and filtering</li>
                            </ul>
                            
                            <div class="code-example">
                                <div class="code-header">Date Field Usage Example</div>
                                <div class="code-content">
                                    <pre><code># Example publication with different dates
{
    "id": 1,
    "document_title": "Climate Data Collection 2020-2023",
    "created_at": "2024-01-15T09:30:00Z",        # Record created in system
    "updated_at": "2024-03-10T14:45:00Z",        # Last metadata update
    "published": "2024-02-01T00:00:00Z",         # Made publicly available
    "timestamp": 1707696000,                      # UNIX timestamp
    
    # Publication Year extracted from published date
    "publication_year": 2024
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Year Extraction -->
                <section id="year-extraction">
                    <h2>Publication Year Extraction</h2>
                    
                    <div class="code-example">
                        <div class="code-header">Publication Year Logic</div>
                        <div class="code-content">
                            <pre><code>def get_publication_year(publication):
    """
    Extract publication year from the published datetime field.
    Returns the year as a 4-digit string.
    """
    if publication.published:
        return publication.published.year
    else:
        # Fallback to created_at if no published date set
        return publication.created_at.year

# Usage in API responses
def serialize_publication(publication):
    return {
        "id": publication.id,
        "document_title": publication.document_title,
        "publication_year": get_publication_year(publication),
        "published_date": publication.published.isoformat() if publication.published else None,
        "created_at": publication.created_at.isoformat()
    }</code></pre>
                        </div>
                    </div>
                </section>

                <!-- API Examples -->
                <section id="api-examples">
                    <h2>API Implementation</h2>
                    
                    <div class="code-example">
                        <div class="code-header">Publication Creation with Date Information</div>
                        <div class="code-content">
                            <pre><code>POST /api/v1/publications/publish
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
    "document_title": "Traditional Medicine Survey Results 2024",
    "document_description": "Comprehensive survey of traditional healing practices...",
    "document_docid": "DOCID.UCT.2024.004",
    "resource_type_id": 1,
    "published": "2024-06-15T10:00:00Z",  # Specific publication date
    "embargo_until": null,                # No embargo
    "creators": [...],
    "organizations": [...]
}</code></pre>
                        </div>
                    </div>
                    
                    <div class="code-example">
                        <div class="code-header">Embargoed Publication Example</div>
                        <div class="code-content">
                            <pre><code>POST /api/v1/publications/publish
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
    "document_title": "Sensitive Research Data on Medicinal Plants",
    "document_description": "Research data with cultural sensitivities...",
    "document_docid": "DOCID.UCT.2024.005",
    "resource_type_id": 1,
    "published": "2025-01-01T00:00:00Z",  # Future publication date
    "embargo_until": "2024-12-31T23:59:59Z",  # Embargo until end of 2024
    "status": "embargoed",
    "creators": [...],
    "organizations": [...]
}</code></pre>
                        </div>
                    </div>
                    
                    <div class="code-example">
                        <div class="code-header">API Response with Publication Year</div>
                        <div class="code-content">
                            <pre><code>GET /api/v1/publications/get-publication/1
Authorization: Bearer {jwt_token}

Response:
{
    "status": "success",
    "data": {
        "id": 1,
        "document_title": "Traditional Medicine Survey Results 2024",
        "document_docid": "DOCID.UCT.2024.004",
        "publication_year": 2024,
        "published_date": "2024-06-15T10:00:00Z",
        "created_date": "2024-01-15T09:30:00Z",
        "updated_date": "2024-03-10T14:45:00Z",
        "status": "published",
        "embargo_status": null,
        "date_metadata": {
            "collection_period": {
                "start": "2023-01-01",
                "end": "2023-12-31"
            },
            "analysis_period": {
                "start": "2024-01-01", 
                "end": "2024-05-31"
            }
        }
    }
}</code></pre>
                        </div>
                    </div>
                </section>

                <!-- Date Scenarios -->
                <section id="date-scenarios">
                    <h2>Publication Date Scenarios</h2>
                    
                    <div class="grid">
                        <div class="card">
                            <h3>ðŸ“… Standard Publication</h3>
                            <p><strong>Scenario:</strong> Resource published immediately upon completion</p>
                            <ul>
                                <li><strong>Published Date:</strong> Current date</li>
                                <li><strong>Publication Year:</strong> Current year</li>
                                <li><strong>Status:</strong> Published</li>
                                <li><strong>Access:</strong> Immediate</li>
                            </ul>
                            <p><strong>Example:</strong> Research completed in March 2024, published immediately</p>
                        </div>
                        
                        <div class="card">
                            <h3>ðŸ”’ Embargoed Publication</h3>
                            <p><strong>Scenario:</strong> Resource completed but access delayed</p>
                            <ul>
                                <li><strong>Published Date:</strong> Future date</li>
                                <li><strong>Publication Year:</strong> Future year</li>
                                <li><strong>Status:</strong> Embargoed</li>
                                <li><strong>Access:</strong> Delayed</li>
                            </ul>
                            <p><strong>Example:</strong> Thesis completed in 2024, embargoed until 2025</p>
                        </div>
                        
                        <div class="card">
                            <h3>ðŸ“š Historical Publication</h3>
                            <p><strong>Scenario:</strong> Digitizing previously published resources</p>
                            <ul>
                                <li><strong>Published Date:</strong> Original publication date</li>
                                <li><strong>Publication Year:</strong> Historical year</li>
                                <li><strong>Status:</strong> Published</li>
                                <li><strong>Access:</strong> Immediate</li>
                            </ul>
                            <p><strong>Example:</strong> 1995 research paper digitized in 2024</p>
                        </div>
                        
                        <div class="card">
                            <h3>ðŸ”„ Version Updates</h3>
                            <p><strong>Scenario:</strong> Updated versions of existing resources</p>
                            <ul>
                                <li><strong>Published Date:</strong> Version publication date</li>
                                <li><strong>Publication Year:</strong> Version year</li>
                                <li><strong>Status:</strong> Published</li>
                                <li><strong>Access:</strong> Version-specific</li>
                            </ul>
                            <p><strong>Example:</strong> Dataset v1.0 (2023), Dataset v2.0 (2024)</p>
                        </div>
                    </div>
                </section>

                <!-- Examples -->
                <section id="examples">
                    <h2>African Research Publication Year Examples</h2>
                    
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Resource Type</th>
                                    <th>Title</th>
                                    <th>Data Collection Period</th>
                                    <th>Publication Year</th>
                                    <th>Institution</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Climate Dataset</td>
                                    <td>Southern African Weather Patterns 2020-2023</td>
                                    <td>2020-2023</td>
                                    <td><strong>2024</strong></td>
                                    <td>University of Cape Town</td>
                                </tr>
                                <tr>
                                    <td>Cultural Archive</td>
                                    <td>Oral Histories of the Ashanti Kingdom</td>
                                    <td>2022-2023</td>
                                    <td><strong>2024</strong></td>
                                    <td>University of Ghana</td>
                                </tr>
                                <tr>
                                    <td>Agricultural Study</td>
                                    <td>Drought-Resistant Maize Varieties</td>
                                    <td>2021-2024</td>
                                    <td><strong>2024</strong></td>
                                    <td>CGIAR Research Centers</td>
                                </tr>
                                <tr>
                                    <td>Medical Research</td>
                                    <td>Traditional Medicine Efficacy Studies</td>
                                    <td>2023-2024</td>
                                    <td><strong>2025</strong> (embargoed)</td>
                                    <td>University of the Witwatersrand</td>
                                </tr>
                                <tr>
                                    <td>Historical Archive</td>
                                    <td>Colonial Administrative Records</td>
                                    <td>1890-1960</td>
                                    <td><strong>2024</strong> (digitized)</td>
                                    <td>National Archives of Nigeria</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Validation Rules -->
                <section id="validation-rules">
                    <h2>Validation Rules</h2>
                    
                    <div class="notice notice-info">
                        <h4>Publication Year Validation Requirements</h4>
                        <ul>
                            <li><strong>Format:</strong> Must be a valid 4-digit year (YYYY)</li>
                            <li><strong>Range:</strong> Year must be between 1000 and current year + 10</li>
                            <li><strong>Future Dates:</strong> Future years allowed for embargoed resources</li>
                            <li><strong>Consistency:</strong> Publication year must match the year from published datetime</li>
                            <li><strong>Required Field:</strong> Publication year cannot be null or empty</li>
                            <li><strong>Logical Validation:</strong> Published date cannot be before created date</li>
                            <li><strong>Embargo Logic:</strong> If embargoed, published date must be in the future</li>
                        </ul>
                    </div>
                    
                    <div class="code-example">
                        <div class="code-header">Validation Logic Example</div>
                        <div class="code-content">
                            <pre><code>def validate_publication_year(published_date, embargo_until=None):
    """
    Validate publication year according to DOCiD rules.
    """
    import datetime
    
    if not published_date:
        raise ValueError("Published date is required")
    
    publication_year = published_date.year
    current_year = datetime.datetime.now().year
    
    # Validate year range
    if publication_year < 1000 or publication_year > current_year + 10:
        raise ValueError(f"Publication year {publication_year} is out of valid range")
    
    # Validate embargo logic
    if embargo_until:
        if published_date <= datetime.datetime.now():
            raise ValueError("Embargoed resources must have future publication dates")
        if embargo_until >= published_date:
            raise ValueError("Embargo end date must be before publication date")
    
    return publication_year</code></pre>
                        </div>
                    </div>
                </section>

                <!-- Navigation -->
                <div class="page-nav">
                    <a href="properties-publisher.html" class="nav-prev">4. Publisher</a>
                    <div></div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="doc-footer">
                <p><strong>DOCiD Metadata Schema Documentation v1.0</strong></p>
                <p>Property 5: Publication Year â€¢ African PID Alliance</p>
                <div class="license">
                    <p>This documentation is licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International (CC BY 4.0)</a></p>
                </div>
            </footer>
        </main>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-top" id="scrollTop" onclick="scrollToTop()">â†‘</button>

    <script>
        // Sidebar toggle for mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Scroll to top functionality
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show/hide scroll to top button
        window.addEventListener('scroll', function() {
            const scrollTop = document.getElementById('scrollTop');
            if (window.pageYOffset > 300) {
                scrollTop.classList.add('visible');
            } else {
                scrollTop.classList.remove('visible');
            }
        });

        // Close sidebar on mobile when clicking outside
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.mobile-menu-toggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !toggle.contains(event.target) && 
                sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
        });
    </script>
</body>
</html>