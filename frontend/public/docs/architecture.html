<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOCiD™ Metadata Schema - System Architecture</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="doc-wrapper">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>DOCiD™ Schema</h2>
                <div class="version-info">Version 1.0</div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Documentation</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">Introduction</a>
                        </li>
                        <li class="nav-item">
                            <a href="architecture.html" class="nav-link active">System Architecture</a>
                        </li>
                        <li class="nav-item">
                            <a href="metadata-schema.html" class="nav-link">Metadata Properties</a>
                            <ul class="nav-sublist">
                                <li class="nav-item">
                                    <a href="metadata-schema.html#core-properties" class="nav-link">Core Properties
                                        (1-8)</a>
                                </li>
                                <li class="nav-item">
                                    <a href="metadata-schema.html#publication-model" class="nav-link">Publication
                                        Model</a>
                                </li>
                                <li class="nav-item">
                                    <a href="metadata-schema.html#creator-model" class="nav-link">Creator Management</a>
                                </li>
                                <li class="nav-item">
                                    <a href="metadata-schema.html#controlled-vocabularies" class="nav-link">Controlled
                                        Vocabularies</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="api-reference.html" class="nav-link">API Reference</a>
                            <ul class="nav-sublist">
                                <li class="nav-item">
                                    <a href="api-reference.html#authentication-endpoints"
                                        class="nav-link">Authentication</a>
                                </li>
                                <li class="nav-item">
                                    <a href="api-reference.html#publication-endpoints" class="nav-link">Publications</a>
                                </li>
                                <li class="nav-item">
                                    <a href="api-reference.html#comments-endpoints" class="nav-link">Comments System</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="external-services.html" class="nav-link">External Services</a>
                            <ul class="nav-sublist">
                                <li class="nav-item">
                                    <a href="external-services.html#cordra-integration" class="nav-link">CORDRA</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#crossref-integration" class="nav-link">Crossref</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#apa-handle-integration" class="nav-link">APA Handle ID</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#datacite-integration" class="nav-link">Datacite</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#cstr-integration" class="nav-link">CSTR</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#ror-integration" class="nav-link">ROR</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#orcid-integration" class="nav-link">ORCID</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#ark-keys-integration" class="nav-link">ARK Keys</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#local-contexts-integration" class="nav-link">Local Contexts</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#arxiv-integration" class="nav-link">ArXiv ID</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#handle-id-integration" class="nav-link">Handle iD</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#hand-id-integration" class="nav-link">Hand iD</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#dpid-integration" class="nav-link">dPID</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#isni-integration" class="nav-link">ISNI</a>
                                </li>
                                <li class="nav-item">
                                    <a href="external-services.html#ringgold-integration" class="nav-link">Ringgold</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Properties</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="properties-identifier.html" class="nav-link">Identifier</a>
                        </li>
                        <li class="nav-item">
                            <a href="properties-creator.html" class="nav-link">Creator</a>
                        </li>
                        <li class="nav-item">
                            <a href="properties-title.html" class="nav-link">Title</a>
                        </li>
                        <li class="nav-item">
                            <a href="properties-publisher.html" class="nav-link">Publisher</a>
                        </li>
                       <li class="nav-item">
                            <a href="properties-resource-type.html" class="nav-link">Resource Type</a>
                        </li>
                       
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Appendices</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#controlled-vocabularies" class="nav-link">Controlled Vocabularies</a>
                        </li>
                        <li class="nav-item">
                            <a href="#cultural-protocols" class="nav-link">Cultural Protocols</a>
                        </li>
                        <li class="nav-item">
                            <a href="#validation-rules" class="nav-link">Validation Rules</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" onclick="toggleSidebar()">☰</button>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-wrapper">
                <header class="doc-header">
                    <h1>System Architecture</h1>
                    <div class="subtitle">Comprehensive overview of DOCiD™'s architectural components, design patterns,
                        and data models</div>
                </header>

                <!-- Architecture Overview -->
                <section id="architecture-overview">
                    <h2>Architecture Overview</h2>
                    <p>The DOCiD™ (Digital Object Container Identifier) system is a sophisticated platform
                        designed to serve as a comprehensive publication and document identifier management system. The
                        system is architected with a focus on persistent identifier (PID) services, metadata management,
                        and scholarly communication tools, specifically designed to support cultural heritage centres, museums, patent offices, funders, facilities, and publishing infrastructures.</p>
                </section>

                <!-- Core Components -->
                <section id="components">
                    <h2>Core Architecture Components</h2>
                    <div class="grid">
                        <div class="card">
                            <h3>Application Layer</h3>
                            <ul>
                                <li>Application factory pattern with comprehensive extension integration</li>
                                <li>Blueprint-based modular architecture with 20+ service-specific routes</li>
                                <li>RESTful API design with JSON payload communication</li>
                                <li>Swagger/OpenAPI documentation integration via Flasgger</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3>Service Layer</h3>
                            <ul>
                                <li>External service integration abstractions</li>
                                <li>Background processing for batch operations</li>
                                <li>Authentication and token management</li>
                                <li>Error handling and fallback mechanisms</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3>Data Layer</h3>
                            <ul>
                                <li>SQLAlchemy ORM with PostgreSQL backend</li>
                                <li>Complex relational model with cascading relationships</li>
                                <li>Migration management via Alembic</li>
                                <li>Reference data and controlled vocabularies</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Architectural Patterns -->
                <section id="patterns">
                    <h2>Key Architectural Patterns</h2>

                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">Identifier Management Centralization</div>
                        </div>
                        <div class="property-content">
                            <p>The system implements a centralized approach to managing multiple persistent identifier
                                types including DOIs, DOCiD™s, Handles, and other PIDs. This ensures consistency across
                                all identifier operations and provides a unified interface for external systems.</p>

                            <h4>Key Features:</h4>
                            <ul>
                                <li>Unified identifier assignment and management</li>
                                <li>Support for multiple identifier schemes simultaneously</li>
                                <li>Automatic identifier validation and format checking</li>
                                <li>Cross-reference resolution between different identifier types</li>
                            </ul>
                        </div>
                    </div>

                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">Hierarchical Data Structures</div>
                        </div>
                        <div class="property-content">
                            <p>Comments system implements a sophisticated tree structure allowing for threaded
                                discussions with parent-child relationships, status management, and moderation
                                capabilities.</p>

                            <h4>Implementation Details:</h4>
                            <ul>
                                <li>Self-referential database relationships</li>
                                <li>Recursive comment retrieval algorithms</li>
                                <li>Status-based visibility management</li>
                                <li>Hierarchical permission inheritance</li>
                            </ul>
                        </div>
                    </div>

                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">Service Integration Abstraction</div>
                        </div>
                        <div class="property-content">
                            <p>External service connectors are abstracted into dedicated service classes, providing
                                consistent interfaces for interacting with Crossref, CSTR, CORDRA, ROR, ORCID, and Local
                                Contexts APIs.</p>

                            <h4>Service Patterns:</h4>
                            <ul>
                                <li>Standardized authentication token management</li>
                                <li>Consistent error handling and retry logic</li>
                                <li>Unified data transformation interfaces</li>
                                <li>Configurable service endpoints and credentials</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Database Architecture -->
                <section id="database">
                    <h2>Database Architecture</h2>
                    <p>The system utilizes PostgreSQL as the primary database, leveraging advanced features like JSON
                        fields, full-text search, and complex indexing strategies.</p>

                    <h3>Core Data Models</h3>

                    <!-- Publications Model -->
                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">Publications Model</div>
                            <div class="property-meta">
                                <span class="property-badge">Core Entity</span>
                                <span>Table: publications</span>
                            </div>
                        </div>
                        <div class="property-content">
                            <p>Central entity managing publication metadata with DOCiD™/DOI assignment and cascading
                                relationships to files, creators, organizations, funders, and projects.</p>

                            <div class="code-example">
                                <div class="code-header">Publications Model Schema</div>
                                <div class="code-content">
                                    <pre><code>class Publications(db.Model):
    __tablename__ = 'publications'

    id = Column(Integer, primary_key=True, autoincrement=True)
    user_id = Column(Integer, ForeignKey('user_accounts.user_id'), nullable=False, index=True)
    document_docid = Column(String(255), nullable=False)
    document_title = Column(String(255), nullable=False)
    document_description = Column(Text)
    resource_type_id = Column(Integer, ForeignKey('resource_types.id'), nullable=False)
    doi = Column(String(50), nullable=False)
    published = Column(DateTime, default=datetime.utcnow)

    # Relationships
    user_account = relationship('UserAccount', back_populates='publications')
    publication_creators = relationship('PublicationCreators', cascade="all, delete-orphan")
    publication_organizations = relationship('PublicationOrganization', cascade="all, delete-orphan")
    publication_funders = relationship('PublicationFunders', cascade="all, delete-orphan")</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- UserAccount Model -->
                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">UserAccount Model</div>
                            <div class="property-meta">
                                <span class="property-badge">User Management</span>
                                <span>Table: user_accounts</span>
                            </div>
                        </div>
                        <div class="property-content">
                            <p>Comprehensive user management with social authentication support and rich profile
                                information including ORCID and ROR ID integration.</p>

                            <div class="code-example">
                                <div class="code-header">UserAccount Model Schema</div>
                                <div class="code-content">
                                    <pre><code>class UserAccount(db.Model):
    __tablename__ = "user_accounts"

    user_id = db.Column(db.Integer, primary_key=True, autoincrement=True)
    user_name = db.Column(db.String(50), nullable=False)
    full_name = db.Column(db.String(100), nullable=False)
    email = db.Column(db.String(100), unique=True, nullable=False)
    orcid_id = db.Column(db.String(50), nullable=True)
    ror_id = db.Column(db.String(50), nullable=True)
    affiliation = db.Column(db.String(100), nullable=True)
    role = db.Column(db.String(50), nullable=True)
    country = db.Column(db.String(50), nullable=True)
    
    # Social media profile links
    linkedin_profile_link = db.Column(db.String(255), nullable=True)
    github_profile_link = db.Column(db.String(255), nullable=True)

    # Relationships
    publications = relationship('Publications', back_populates='user_account')</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PublicationCreators Model -->
                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">PublicationCreators Model</div>
                            <div class="property-meta">
                                <span class="property-badge">Creator Management</span>
                                <span>Table: publication_creators</span>
                            </div>
                        </div>
                        <div class="property-content">
                            <p>Author/creator management with role assignment and multiple identifier scheme support.
                            </p>

                            <div class="code-example">
                                <div class="code-header">PublicationCreators Model Schema</div>
                                <div class="code-content">
                                    <pre><code>class PublicationCreators(db.Model):
    __tablename__ = 'publication_creators'

    id = Column(Integer, primary_key=True, autoincrement=True)
    publication_id = Column(Integer, ForeignKey('publications.id'), nullable=False, index=True)
    family_name = Column(String(255), nullable=False)
    given_name = Column(String(255))
    identifier = Column(String(500))  # Full resolvable URL (e.g., https://orcid.org/...)
    identifier_type = Column(String(50))  # Type (e.g., 'orcid', 'isni', 'viaf')
    role_id = Column(String(255), nullable=False)

    # Relationships
    publication = relationship('Publications', back_populates='publication_creators')</code></pre>
                                </div>
                            </div>

                            <h4>Supported Creator Identifiers:</h4>
                            <ul>
                                <li><strong>ORCID:</strong> https://orcid.org/0000-0000-0000-0000</li>
                                <li><strong>ISNI:</strong> https://isni.org/isni/0000000000000000</li>
                                <li><strong>VIAF:</strong> http://viaf.org/viaf/123456789</li>
                                <li><strong>ResearcherID:</strong> http://www.researcherid.com/rid/A-1234-2012</li>
                                <li><strong>Scopus ID:</strong> Scopus author identifier URLs</li>
                            </ul>
                        </div>
                    </div>

                    <!-- PublicationComments Model -->
                    <div class="property">
                        <div class="property-header">
                            <div class="property-title">PublicationComments Model</div>
                            <div class="property-meta">
                                <span class="property-badge">Comments System</span>
                                <span>Table: publication_comments</span>
                            </div>
                        </div>
                        <div class="property-content">
                            <p>Hierarchical comment structure with parent-child relationships, status management, and
                                engagement tracking.</p>

                            <div class="code-example">
                                <div class="code-header">PublicationComments Model Schema</div>
                                <div class="code-content">
                                    <pre><code>class PublicationComments(db.Model):
    __tablename__ = 'publication_comments'
    
    id = db.Column(db.Integer, primary_key=True, autoincrement=True)
    publication_id = db.Column(db.Integer, db.ForeignKey('publications.id'), nullable=False)
    user_id = db.Column(db.Integer, db.ForeignKey('user_accounts.user_id'), nullable=False)
    parent_comment_id = db.Column(db.Integer, db.ForeignKey('publication_comments.id'), nullable=True)
    comment_text = db.Column(db.Text, nullable=False)
    comment_type = db.Column(db.String(50), default='general')
    status = db.Column(db.String(20), default='active')
    likes_count = db.Column(db.Integer, default=0)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    # Self-referential relationship for hierarchical comments
    parent_comment = db.relationship('PublicationComments', remote_side=[id], backref='replies')</code></pre>
                                </div>
                            </div>

                            <h4>Comment Features:</h4>
                            <ul>
                                <li><strong>Hierarchical Structure:</strong> Parent-child relationships for threaded
                                    discussions</li>
                                <li><strong>Comment Types:</strong> general, review, question, suggestion</li>
                                <li><strong>Status Management:</strong> active, edited, deleted, flagged states</li>
                                <li><strong>Engagement:</strong> Like counts and reply threading</li>
                                <li><strong>Moderation:</strong> User vs admin permissions for editing/deletion</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Authentication & Authorization -->
                <section id="auth">
                    <h2>Authentication & Authorization</h2>

                    <div class="grid">
                        <div class="card">
                            <h3>JWT-Based Authentication</h3>
                            <ul>
                                <li>JWT-Extended implementation</li>
                                <li>Access and refresh token management</li>
                                <li>Role-based access control</li>
                                <li>Social authentication integration</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3>Social Authentication Providers</h3>
                            <ul>
                                <li>Google OAuth 2.0</li>
                                <li>ORCID OAuth 2.0</li>
                                <li>GitHub OAuth 2.0</li>
                               
                            </ul>
                        </div>

                        <div class="card">
                            <h3>Permission Management</h3>
                            <ul>
                                <li>User role hierarchy (user, admin, superadmin)</li>
                                <li>Resource-based permissions</li>
                                <li>Comment moderation permissions</li>
                                <li>Publication ownership controls</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Database Relationships -->
                <section id="relationships">
                    <h2>Database Relationships</h2>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Relationship Type</th>
                                    <th>Primary Entity</th>
                                    <th>Related Entity</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>One-to-Many</strong></td>
                                    <td>UserAccount</td>
                                    <td>Publications</td>
                                    <td>User ownership of publications</td>
                                </tr>
                                <tr>
                                    <td><strong>One-to-Many</strong></td>
                                    <td>Publications</td>
                                    <td>PublicationComments</td>
                                    <td>Publication discussions</td>
                                </tr>
                                <tr>
                                    <td><strong>One-to-Many</strong></td>
                                    <td>Publications</td>
                                    <td>PublicationCreators</td>
                                    <td>Multiple authors per publication</td>
                                </tr>
                                <tr>
                                    <td><strong>One-to-Many</strong></td>
                                    <td>Publications</td>
                                    <td>PublicationOrganization</td>
                                    <td>Multiple affiliations</td>
                                </tr>
                                <tr>
                                    <td><strong>One-to-Many</strong></td>
                                    <td>Publications</td>
                                    <td>PublicationFunders</td>
                                    <td>Multiple funding sources</td>
                                </tr>
                                <tr>
                                    <td><strong>Self-Referential</strong></td>
                                    <td>PublicationComments</td>
                                    <td>PublicationComments</td>
                                    <td>Parent-child hierarchy for threaded comments</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Reference Data Models -->
                <section id="reference-data">
                    <h2>Reference Data Models</h2>
                    <p>DOCiD™ implements comprehensive controlled vocabularies for consistent metadata classification.
                    </p>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Model</th>
                                    <th>Table</th>
                                    <th>Purpose</th>
                                    <th>Key Fields</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>ResourceTypes</strong></td>
                                    <td>resource_types</td>
                                    <td>Publication resource classifications</td>
                                    <td>id, resource_type</td>
                                </tr>
                                <tr>
                                    <td><strong>CreatorsRoles</strong></td>
                                    <td>creators_roles</td>
                                    <td>Creator role taxonomies</td>
                                    <td>id, role_id, role_name</td>
                                </tr>
                                <tr>
                                    <td><strong>FunderTypes</strong></td>
                                    <td>funder_types</td>
                                    <td>Funding organization categories</td>
                                    <td>id, funder_type_name</td>
                                </tr>
                                <tr>
                                    <td><strong>PublicationTypes</strong></td>
                                    <td>publication_types</td>
                                    <td>Document type classifications</td>
                                    <td>id, publication_type_name</td>
                                </tr>
                                <tr>
                                    <td><strong>PublicationIdentifierTypes</strong></td>
                                    <td>identifier_types</td>
                                    <td>Identifier scheme registry</td>
                                    <td>id, identifier_type_name</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Navigation -->
                <div class="page-nav">
                    <a href="index.html" class="nav-prev">Introduction</a>
                    <a href="metadata-schema.html" class="nav-next">Metadata Properties</a>
                </div>
            </div>

            <!-- Footer -->
            <footer class="doc-footer">
                <p><strong>DOCiD™ Metadata Schema Documentation v1.0</strong></p>
                <p>System Architecture • African PID Alliance</p>
                <div class="license">
                    <p>This documentation is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"
                            target="_blank">Creative Commons Attribution 4.0 International (CC BY 4.0)</a></p>
                </div>
            </footer>
        </main>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-top" id="scrollTop" onclick="scrollToTop()">↑</button>

    <script>
        // Sidebar toggle for mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Scroll to top functionality
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show/hide scroll to top button
        window.addEventListener('scroll', function () {
            const scrollTop = document.getElementById('scrollTop');
            if (window.pageYOffset > 300) {
                scrollTop.classList.add('visible');
            } else {
                scrollTop.classList.remove('visible');
            }
        });

        // Close sidebar on mobile when clicking outside
        document.addEventListener('click', function (event) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.mobile-menu-toggle');

            if (window.innerWidth <= 768 &&
                !sidebar.contains(event.target) &&
                !toggle.contains(event.target) &&
                sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
        });
    </script>
</body>

</html>